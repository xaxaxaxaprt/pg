(function(M,ue,ge,S,V,fe,O,h,r,e,X,L,j,he,ye){"use strict";function pe(t){const{metro:{findByProps:n,findByStoreName:d,common:{lodash:{merge:l}}}}=t,u=n("_sendMessage"),{createBotMessage:f}=n("createBotMessage"),g=n("BOT_AVATARS"),{getChannelId:c}=d("SelectedChannelStore");return function(a,s){if(a.channelId??=c(),[null,void 0].includes(a.channelId))throw new Error("No channel id to receive the message into (channelId)");let o=a;if(a.really){typeof s=="object"&&(o=l(o,s));const y=[o,{}];y[0].tts??=!1;for(const w of["allowedMentions","messageReference"])w in y[0]&&(y[1][w]=y[0][w],delete y[0][w]);const b="overwriteSendMessageArg2";return b in y[0]&&(y[1]=y[0][b],delete y[0][b]),u._sendMessage(a.channelId,...y)}return s!==!0&&(o=f(o)),typeof s=="object"&&(o=l(o,s),typeof s.author=="object"&&function(){const y=s.author;typeof y.avatarURL=="string"&&(g.BOT_AVATARS[y.avatar??y.avatarURL]=y.avatarURL,y.avatar??=y.avatarURL,delete y.avatarURL)}()),u.receiveMessage(o.channel_id,o),o}}function we(t,n=27){if(typeof t!="string")throw new Error("Passed chars isn't a string");if(t?.length<=0)throw new Error("Invalid chars length");let d="";for(let l=0;l<n;l++)d+=t[Math.floor(Math.random()*t.length)];return d}const be={command:"https://cdn.discordapp.com/attachments/1099116247364407337/1112129955053187203/command.png"},Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=Y.replace("+/","_-");function Re(t,n){if(typeof t!="number")throw new Error(`Passed data isn't a number (received: ${typeof t})`);let d="";for(;t>0;)d=(n?q:Y).charAt(t%64)+d,t=Math.floor(t/64);return d}const $=[],ve=1e3;function i(t,n,d=null){const l={timestamp:new Date().toISOString(),type:t,message:n,data:d};$.unshift(l),$.length>ve&&$.pop(),r.storage?.settings?.enableUnsafeFeatures&&console.log(`[AccountSwitcher] ${t.toUpperCase()}: ${n}`,d||"")}function Q(){return $}function ke(){$.length=0,i("info","Logs cleared")}function ee(t){let n=0;if(t.length===0)return n.toString();for(let d=0;d<t.length;d++){const l=t.charCodeAt(d);n=(n<<5)-n+l,n=n&n}return Math.abs(n).toString(36)}function Te({dialogInfo:t,onCancel:n,onSuccess:d,storage:l}){const[u,f]=e.React.useState(""),g=function(){if(!u.trim()){h.showToast("Please enter the password",1);return}ee(u)===l.settings.exportPasswordHash?(i("info","Password verification successful",{type:t.type}),d()):(i("warn","Incorrect password attempt",{type:t.type}),h.showToast("Incorrect password",1))};return e.React.createElement(e.ReactNative.View,{style:{flex:1,backgroundColor:"#2f3136"}},[e.React.createElement(e.ReactNative.View,{key:"pwd-header",style:{flexDirection:"row",alignItems:"center",padding:16,backgroundColor:"#202225",borderBottomWidth:1,borderBottomColor:"#40444b"}},[e.React.createElement(e.ReactNative.TouchableOpacity,{key:"back",onPress:n,style:{marginRight:16}},e.React.createElement(e.ReactNative.Text,{style:{color:"#7289da",fontSize:16}},"\u2190 Cancel")),e.React.createElement(e.ReactNative.Text,{key:"title",style:{color:"white",fontSize:18,fontWeight:"bold"}},t.title)]),e.React.createElement(e.ReactNative.View,{key:"pwd-content",style:{flex:1,padding:16,justifyContent:"center"}},[e.React.createElement(e.ReactNative.Text,{key:"message",style:{color:"#b9bbbe",fontSize:16,marginBottom:20,textAlign:"center"}},t.message),e.React.createElement(e.ReactNative.TextInput,{key:"password-input",placeholder:"Enter password",placeholderTextColor:"#72767d",value:u,onChangeText:f,secureTextEntry:!0,style:{backgroundColor:"#40444b",color:"white",padding:16,borderRadius:8,marginBottom:20,fontSize:16}}),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"confirm-btn",onPress:g,style:{backgroundColor:"#7289da",paddingVertical:16,paddingHorizontal:20,borderRadius:8,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:18,fontWeight:"bold"}},"Confirm"))])])}S.findByStoreName("UserStore");const me=S.findByProps("getToken");S.findByProps("login","logout","loginMFA");const te=S.findByProps("post","get","patch"),Se=async function(t,n){(function(d){t.settings?.exportPasswordHash?n({type:"export",title:"Enter Export Password",message:"Enter your password to export accounts",callback:d}):d()})(function(){L.showConfirmationAlert({title:"\u26A0\uFE0F Export Accounts - Security Warning",content:"Exporting accounts is UNSAFE and may lead to account takeover if shared with others. The export contains sensitive authentication tokens that give full access to your accounts. Only proceed if you understand the risks and will keep the data secure.",confirmText:"I Understand - Export",cancelText:"Cancel",confirmColor:"brand",onConfirm:async function(){try{i("info","Starting account export");const d=t.accounts||{},l=Object.values(d).map(function(f){return{username:f.username,discriminator:f.discriminator,avatar:f.avatar,id:f.id,token:f.token,addedAt:f.addedAt||Date.now()}}),u={accounts:l,exportPasswordHash:t.settings?.exportPasswordHash||null,exportedAt:Date.now(),version:"2.0"};e.clipboard.setString(JSON.stringify(u,null,2)),i("info","Accounts exported successfully",{count:l.length}),h.showToast(`Exported ${l.length} accounts to clipboard`,0)}catch(d){i("error","Failed to export accounts",{error:d.message}),console.error("Export error:",d),h.showToast("Failed to export accounts",1)}}})})},Ce=async function(t,n,d){(function(l){t.settings?.exportPasswordHash?n({type:"import",title:"Enter Import Password",message:"Enter your password to import accounts",callback:l}):l()})(function(){L.showConfirmationAlert({title:"\u26A0\uFE0F Import Accounts - Security Warning",content:"Importing accounts is UNSAFE and may compromise your security if the data comes from untrusted sources. Only import data you exported yourself or from sources you completely trust. Malicious imports could lead to account takeover.",confirmText:"I Understand - Import",cancelText:"Cancel",confirmColor:"brand",onConfirm:async function(){try{i("info","Starting account import");let l=d.trim();if(!l)try{l=await e.clipboard.getString()}catch(a){i("error","Failed to get clipboard data",{error:a.message}),h.showToast("No data in clipboard or input field",1);return}if(!l){i("warn","No data to import"),h.showToast("No data to import",1);return}const u=JSON.parse(l);let f;if(u.accounts&&Array.isArray(u.accounts)){if(u.exportPasswordHash&&(!t.settings?.exportPasswordHash||t.settings.exportPasswordHash!==u.exportPasswordHash)){i("error","Import password mismatch"),h.showToast("Import password mismatch or not set locally",1);return}f=u.accounts,u.exportPasswordHash&&!t.settings?.exportPasswordHash&&(t.settings.exportPasswordHash=u.exportPasswordHash,i("info","Import password hash set from import data"))}else if(Array.isArray(u))f=u,i("debug","Using legacy import format");else{i("error","Invalid import format"),h.showToast("Invalid import format",1);return}let g=0,c=0;f.forEach(function(a){a.id&&a.token&&a.username&&(t.accounts[a.id]?c++:(t.accounts[a.id]={id:a.id,username:a.username,discriminator:a.discriminator||"0",avatar:a.avatar||null,displayName:a.displayName||a.username,token:a.token,addedAt:a.addedAt||Date.now()},t.accountOrder.includes(a.id)||t.accountOrder.push(a.id),g++))}),i("info","Import completed",{imported:g,skipped:c}),h.showToast(`Imported ${g} accounts, skipped ${c} duplicates`,0)}catch(l){i("error","Import failed",{error:l.message}),console.error("Import error:",l),h.showToast("Failed to import - invalid format or password mismatch",1)}}})})},Ne=function(t,n,d,l,u){if(!n.trim()){h.showToast("Please enter a password",1);return}if(n!==d){h.showToast("Passwords don't match",1);return}const f=ee(n);t.settings.exportPasswordHash=f,l(""),u(""),i("info","Export password set successfully"),h.showToast("Export password set successfully",0)},Ae=function(t,n){(function(d){n({type:"remove",title:"Enter Password to Remove",message:"Enter your current password to remove protection",callback:d})})(function(){L.showConfirmationAlert({title:"Remove Export Password",content:"Are you sure you want to remove the export password? This will make exports/imports less secure.",confirmText:"Remove Password",cancelText:"Cancel",confirmColor:"brand",onConfirm:function(){delete t.settings.exportPasswordHash,i("info","Export password removed"),h.showToast("Export password removed",0)}})})},Ee=async function(t,n,d,l){if(t.settings.enableUnsafeFeatures){l(!0),i("info","Starting token account addition");try{let u=n.trim();if(u||(u=me.getToken(),i("debug","Using current account token")),!u.startsWith("Bot ")&&!u.match(/^[A-Za-z0-9_-]{24,}\.[A-Za-z0-9_-]{6}\.[A-Za-z0-9_-]{27,}$/)){i("error","Invalid token format provided"),h.showToast("Invalid token format",1),l(!1);return}i("debug","Fetching user info from Discord API");const f=await fetch("https://discord.com/api/v9/users/@me",{headers:{Authorization:u,"Content-Type":"application/json"}});if(!f.ok){i("error","Discord API request failed",{status:f.status,statusText:f.statusText}),h.showToast("Invalid or expired token",1),l(!1);return}const g=await f.json();i("info","Successfully retrieved user info",{username:g.username,id:g.id});const c={id:g.id,username:g.username,discriminator:g.discriminator,avatar:g.avatar,displayName:g.global_name||g.username};if(t.accounts[c.id]){i("warn","Account already exists",{username:c.username}),h.showToast(`Account ${c.username} already saved`,1),l(!1);return}const a={...c,token:u,addedAt:Date.now()};t.accounts[c.id]=a,t.accountOrder.includes(c.id)||t.accountOrder.push(c.id),d(""),i("info","Account added successfully via token",{username:c.username}),h.showToast(`Account ${c.username} added!`,0)}catch(u){i("error","Failed to add account via token",{error:u.message,stack:u.stack}),console.error("Add account error:",u),h.showToast("Failed to add account",1)}l(!1)}},xe=async function(){L.showConfirmationAlert({title:"Force Logout",content:"This will logout your current session by using an invalid token. Your saved accounts will remain intact. Continue?",confirmText:"Force Logout",cancelText:"Cancel",confirmColor:"brand",onConfirm:async function(){try{i("info","Starting force logout");const t="invalid_token_for_force_logout";await S.findByProps("login","logout","switchAccountToken").switchAccountToken(t),i("info","Force logout completed successfully"),h.showToast("Force logout successful - you can now login to a different account",0)}catch(t){i("warn","Force logout completed with error",{error:t.message}),console.error("Force logout error:",t),h.showToast("Force logout completed",0)}}})},ae=async function(t,n,d,l,u,f,g,c=null,a=null,s=null,o=null){if(!a&&(!n.trim()||!d.trim())){h.showToast("Please enter both email and password",1);return}g(!0);let y=null;try{if(a&&c){const T=c.trim().replace(/\s/g,"").replace(/-/g,"");i("info","Completing 2FA verification",{codeLength:T.length,ticketLength:a?.length,ticketStart:a?.substring(0,20)});const v=T.length===8,C=v?"/auth/mfa/backup":"/auth/mfa/totp";i("debug","MFA request details",{endpoint:v?"backup":"totp",codeToSend:T});let p;if(te?.post)try{i("debug","Using Discord internal HTTP module");const N=await te.post({url:C,body:{code:T,ticket:a,gift_code_sku_id:null,login_source:null}});p=N.body,i("debug","2FA response (internal)",{hasToken:!!p?.token,status:N.status})}catch(N){i("debug","Internal HTTP failed, trying fetch",{error:N.message}),p=null}if(!p?.token){const N=await fetch(`https://discord.com/api/v9${C}`,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"},body:JSON.stringify({code:T,ticket:a,gift_code_sku_id:null,login_source:null})});p=await N.json(),i("debug","2FA response (fetch)",{status:N.status,hasToken:!!p.token,message:p.message})}if(!p?.token){i("error","2FA verification failed",{message:p?.message,code:p?.code});let N="Invalid 2FA code";p?.message?N=p.message:p?.code===60008?N="Invalid 2FA code - check your authenticator time sync":p?.code===60002&&(N="2FA ticket expired - try again"),h.showToast(N,1),g(!1);return}y=p.token,s&&s(null),o&&o(!1)}else{i("info","Starting credential-based account addition",{email:n.trim()});const T=await fetch("https://discord.com/api/v9/auth/login",{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","X-Super-Properties":"eyJvcyI6IldpbmRvd3MiLCJicm93c2VyIjoiQ2hyb21lIiwiZGV2aWNlIjoiIiwic3lzdGVtX2xvY2FsZSI6ImVuLVVTIiwiYnJvd3Nlcl91c2VyX2FnZW50IjoiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEyMC4wLjAuMCBTYWZhcmkvNTM3LjM2IiwiYnJvd3Nlcl92ZXJzaW9uIjoiMTIwLjAuMC4wIiwib3NfdmVyc2lvbiI6IjEwIiwicmVmZXJyZXIiOiIiLCJyZWZlcnJpbmdfZG9tYWluIjoiIiwicmVmZXJyZXJfY3VycmVudCI6IiIsInJlZmVycmluZ19kb21haW5fY3VycmVudCI6IiIsInJlbGVhc2VfY2hhbm5lbCI6InN0YWJsZSIsImNsaWVudF9idWlsZF9udW1iZXIiOjI1NTkyMSwiY2xpZW50X2V2ZW50X3NvdXJjZSI6bnVsbH0="},body:JSON.stringify({login:n.trim(),password:d.trim(),undelete:!1})}),v=await T.json();if(v.ticket&&v.mfa){i("info","2FA required for this account",{ticket:v.ticket,mfa:v.mfa,sms:v.sms,backup:v.backup,totp:v.totp,webauthn:v.webauthn}),s&&s(v.ticket),o&&o(!0),h.showToast("2FA required - enter your code",0),g(!1);return}if(!T.ok||!v.token){i("error","Discord login failed",{status:T.status,message:v.message,errors:v.errors,captchaRequired:!!v.captcha_key});let C="Login failed";if(v.captcha_key)C="Captcha required - please login through Discord first";else if(v.message){const p=v.message.toLowerCase();p.includes("invalid")&&(p.includes("email")||p.includes("phone")||p.includes("login"))?C="Invalid email or username":p.includes("password")?C="Invalid password":p.includes("account")?C="Account issue - check your credentials":p.includes("rate limit")||p.includes("too many")?C="Too many attempts - please wait and try again":C="Login failed - check your credentials"}else if(v.errors){const p=v.errors;p.login?C="Invalid email or username":p.password?C="Invalid password":C="Invalid credentials"}else T.status===401?C="Invalid credentials":T.status===429?C="Rate limited - please wait and try again":T.status>=500&&(C="Discord servers are having issues - try again later");h.showToast(C,1),g(!1);return}y=v.token}i("debug","Login successful, fetching user info");const b=await fetch("https://discord.com/api/v9/users/@me",{headers:{Authorization:y}});if(!b.ok){i("error","Failed to get user info after login",{status:b.status}),h.showToast("Login succeeded but failed to get user info - check logs",1),g(!1);return}const w=await b.json();if(t.accounts[w.id]){i("warn","Account already exists",{username:w.username}),h.showToast(`Account ${w.username} already saved`,1),g(!1);return}const m={id:w.id,username:w.username,discriminator:w.discriminator,avatar:w.avatar,displayName:w.global_name||w.username,token:y,addedAt:Date.now()};t.accounts[w.id]=m,t.accountOrder.includes(w.id)||t.accountOrder.push(w.id),l(""),u(""),f(!1),i("info","Account added successfully via credentials",{username:w.username}),h.showToast(`Account ${w.username} added successfully!`,0)}catch(b){i("error","Credential login failed",{error:b.message,stack:b.stack}),console.error("Login error:",b);let w="Login failed - check logs for more info";b.message.includes("network")||b.message.includes("fetch")?w="Network error - check your connection":b.message.includes("timeout")&&(w="Request timed out - try again"),h.showToast(w,1)}g(!1)},re=S.findByStoreName("UserStore"),ne=S.findByProps("getToken");r.storage.accounts||(r.storage.accounts={}),r.storage.accountOrder||(r.storage.accountOrder=[]),r.storage.settings?(r.storage.settings.enableUnsafeFeatures===void 0&&(r.storage.settings.enableUnsafeFeatures=!1),r.storage.settings.enableCLI===void 0&&(r.storage.settings.enableCLI=r.storage.settings.showAccountNames!==!1),r.storage.settings.confirmBeforeDelete===void 0&&(r.storage.settings.confirmBeforeDelete=!0),r.storage.settings.addToSidebar===void 0&&(r.storage.settings.addToSidebar=!0),r.storage.settings.showAccountNames!==void 0&&delete r.storage.settings.showAccountNames):r.storage.settings={enableCLI:!0,confirmBeforeDelete:!0,enableUnsafeFeatures:!1,addToSidebar:!0},i("info","AccountSwitcher plugin initialized",{accountsCount:Object.keys(r.storage.accounts).length,cliEnabled:r.storage.settings.enableCLI,unsafeFeaturesEnabled:r.storage.settings.enableUnsafeFeatures});function Ie({onBack:t}){X.useProxy(r.storage);const[n,d]=e.React.useState(""),[l,u]=e.React.useState(!1),[f,g]=e.React.useState(""),[c,a]=e.React.useState(null),[s,o]=e.React.useState(""),[y,b]=e.React.useState(""),w=function(p,N){const P={...r.storage.settings,[p]:N};r.storage.settings=P,i("info",`Setting updated: ${p}`,{newValue:N})},m=function(){const p=Q(),N=p.map(function(P){return`[${P.timestamp}] ${P.type.toUpperCase()}: ${P.message}${P.data?" | Data: "+JSON.stringify(P.data):""}`}).join(`
`);e.clipboard.setString(N),i("info","Logs copied to clipboard",{count:p.length}),h.showToast(`Copied ${p.length} log entries to clipboard`,0)},T=function(p){p?L.showConfirmationAlert({title:"Enable Unsafe Features - Security Warning",content:"Unsafe features include token copying, manual token adding, and detailed logging. These features can compromise your account security if misused. Tokens provide full access to accounts and should never be shared. Only enable if you understand the security implications.",confirmText:"I Understand - Enable",cancelText:"Cancel",confirmColor:"brand",onConfirm:function(){return w("enableUnsafeFeatures",!0)}}):w("enableUnsafeFeatures",!1)},v=function(){a(null)},C=function(){const p=c.callback;a(null),p()};return c?e.React.createElement(Te,{dialogInfo:c,onCancel:v,onSuccess:C,storage:r.storage}):e.React.createElement(e.ReactNative.View,{style:{flex:1,backgroundColor:"#1a1b1e"}},[e.React.createElement(e.ReactNative.View,{key:"header",style:{flexDirection:"row",alignItems:"center",padding:20,backgroundColor:"#111214",borderBottomWidth:0}},[e.React.createElement(e.ReactNative.TouchableOpacity,{key:"back",onPress:t,style:{marginRight:16}},e.React.createElement(e.ReactNative.Text,{style:{color:"#5865f2",fontSize:15,fontWeight:"600"}},"\u2190 Back")),e.React.createElement(e.ReactNative.Text,{key:"title",style:{color:"white",fontSize:18,fontWeight:"bold"}},"Settings")]),e.React.createElement(e.ReactNative.ScrollView,{key:"content",style:{flex:1,padding:16},contentContainerStyle:{paddingBottom:100}},[e.React.createElement(e.ReactNative.View,{key:"export-import",style:{marginBottom:24}},[e.React.createElement(e.ReactNative.Text,{key:"export-title",style:{color:"#8e9297",fontSize:12,fontWeight:"700",marginBottom:16,letterSpacing:.5}},"BACKUP & RESTORE"),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"export-btn",onPress:function(){return Se(r.storage,a)},style:{backgroundColor:"#5865f2",paddingVertical:14,paddingHorizontal:20,borderRadius:12,marginBottom:12,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:15,fontWeight:"600"}},"Export Accounts")),e.React.createElement(e.ReactNative.TextInput,{key:"import-input",placeholder:"Paste exported account data here (or leave empty to use clipboard)...",placeholderTextColor:"#72767d",value:f,onChangeText:g,multiline:!0,numberOfLines:4,style:{backgroundColor:"#2b2d31",color:"white",padding:14,borderRadius:12,marginBottom:12,fontSize:14,textAlignVertical:"top",borderWidth:1,borderColor:"#3f4147"}}),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"import-btn",onPress:function(){return Ce(r.storage,a,f)},style:{backgroundColor:"#248046",paddingVertical:14,paddingHorizontal:20,borderRadius:12,marginBottom:12,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:15,fontWeight:"600"}},"Import Accounts")),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"force-logout-btn",onPress:xe,style:{backgroundColor:"#da373c",paddingVertical:14,paddingHorizontal:20,borderRadius:12,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:15,fontWeight:"600"}},"Force Logout"))]),e.React.createElement(e.ReactNative.View,{key:"export-password",style:{marginBottom:24}},[e.React.createElement(e.ReactNative.Text,{key:"password-title",style:{color:"#8e9297",fontSize:12,fontWeight:"700",marginBottom:16,letterSpacing:.5}},"EXPORT PASSWORD PROTECTION"),r.storage.settings.exportPasswordHash?e.React.createElement(e.ReactNative.View,{key:"password-set"},[e.React.createElement(e.ReactNative.Text,{key:"status",style:{color:"#43b581",fontSize:16,marginBottom:12}},"Export password is set (hashed)"),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"remove-pwd",onPress:function(){return Ae(r.storage,a)},style:{backgroundColor:"#f04747",paddingVertical:12,paddingHorizontal:16,borderRadius:8,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:16,fontWeight:"bold"}},"Remove Password"))]):e.React.createElement(e.ReactNative.View,{key:"password-unset"},[e.React.createElement(e.ReactNative.Text,{key:"desc",style:{color:"#72767d",fontSize:14,marginBottom:12}},"Set a password to protect your account exports and imports (will be hashed for security)"),e.React.createElement(e.ReactNative.TextInput,{key:"new-password",placeholder:"New password",placeholderTextColor:"#72767d",value:s,onChangeText:o,secureTextEntry:!0,style:{backgroundColor:"#40444b",color:"white",padding:12,borderRadius:8,marginBottom:8,fontSize:14}}),e.React.createElement(e.ReactNative.TextInput,{key:"confirm-password",placeholder:"Confirm password",placeholderTextColor:"#72767d",value:y,onChangeText:b,secureTextEntry:!0,style:{backgroundColor:"#40444b",color:"white",padding:12,borderRadius:8,marginBottom:12,fontSize:14}}),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"set-password",onPress:function(){return Ne(r.storage,s,y,o,b)},style:{backgroundColor:"#7289da",paddingVertical:12,paddingHorizontal:16,borderRadius:8,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:16,fontWeight:"bold"}},"Set Password"))])]),e.React.createElement(e.ReactNative.View,{key:"unsafe",style:{marginBottom:24}},[e.React.createElement(e.ReactNative.Text,{key:"unsafe-title",style:{color:"#da373c",fontSize:12,fontWeight:"700",marginBottom:16,letterSpacing:.5}},"UNSAFE FEATURES"),e.React.createElement(e.ReactNative.View,{key:"enable-unsafe",style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:12,backgroundColor:"#2b2d31",paddingHorizontal:16,borderRadius:12,marginBottom:8}},[e.React.createElement(e.ReactNative.View,{key:"text-container",style:{flex:1}},[e.React.createElement(e.ReactNative.Text,{key:"label",style:{color:"white",fontSize:16}},"Enable Unsafe Features"),e.React.createElement(e.ReactNative.Text,{key:"desc",style:{color:"#72767d",fontSize:12,marginTop:2}},"Allows token operations, detailed logging, and troubleshooting")]),e.React.createElement(e.ReactNative.Switch,{key:"toggle",value:r.storage.settings.enableUnsafeFeatures,onValueChange:T,trackColor:{false:"#72767d",true:"#f04747"},thumbColor:"white"})]),r.storage.settings.enableUnsafeFeatures&&e.React.createElement(e.ReactNative.View,{key:"unsafe-features",style:{marginTop:16}},[e.React.createElement(e.ReactNative.Text,{key:"logging-title",style:{color:"#b9bbbe",fontSize:14,fontWeight:"bold",marginBottom:8}},"TROUBLESHOOTING & LOGGING"),e.React.createElement(e.ReactNative.View,{key:"log-actions",style:{flexDirection:"row",gap:8,marginBottom:16}},[e.React.createElement(e.ReactNative.TouchableOpacity,{key:"copy-logs",onPress:m,style:{flex:1,backgroundColor:"#7289da",paddingVertical:10,paddingHorizontal:12,borderRadius:6,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:14,fontWeight:"bold"}},`Copy Logs (${Q().length})`)),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"clear-logs",onPress:ke,style:{flex:1,backgroundColor:"#f04747",paddingVertical:10,paddingHorizontal:12,borderRadius:6,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:14,fontWeight:"bold"}},"Clear Logs"))]),e.React.createElement(e.ReactNative.Text,{key:"token-title",style:{color:"#b9bbbe",fontSize:14,fontWeight:"bold",marginBottom:8}},"ADD ACCOUNT VIA TOKEN"),e.React.createElement(e.ReactNative.TextInput,{key:"token-input",placeholder:"Paste account token here (leave empty to add current account)...",placeholderTextColor:"#72767d",value:n,onChangeText:d,secureTextEntry:!0,style:{backgroundColor:"#40444b",color:"white",padding:12,borderRadius:8,marginBottom:12,fontSize:14}}),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"add-btn",onPress:function(){return Ee(r.storage,n,d,u)},disabled:l,style:{backgroundColor:l?"#5c6bc0":"#7289da",paddingVertical:12,paddingHorizontal:20,borderRadius:8,alignItems:"center",opacity:l?.6:1}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:16,fontWeight:"bold"}},l?"Adding...":n.trim()?"Add Account":"Add Current Account"))])]),e.React.createElement(e.ReactNative.View,{key:"general",style:{marginBottom:24}},[e.React.createElement(e.ReactNative.Text,{key:"general-title",style:{color:"#b9bbbe",fontSize:14,fontWeight:"bold",marginBottom:12}},"GENERAL"),e.React.createElement(e.ReactNative.View,{key:"enable-cli",style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:12,backgroundColor:"#2b2d31",paddingHorizontal:16,borderRadius:12,marginBottom:8}},[e.React.createElement(e.ReactNative.Text,{key:"label",style:{color:"white",fontSize:16}},"Enable CLI Interface"),e.React.createElement(e.ReactNative.Switch,{key:"toggle",value:r.storage.settings.enableCLI,onValueChange:function(p){return w("enableCLI",p)},trackColor:{false:"#72767d",true:"#7289da"},thumbColor:"white"})]),e.React.createElement(e.ReactNative.View,{key:"add-to-sidebar",style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:12,backgroundColor:"#2b2d31",paddingHorizontal:16,borderRadius:12,marginBottom:8}},[e.React.createElement(e.ReactNative.View,{key:"text-container",style:{flex:1}},[e.React.createElement(e.ReactNative.Text,{key:"label",style:{color:"white",fontSize:16}},"Add to Settings Sidebar"),e.React.createElement(e.ReactNative.Text,{key:"desc",style:{color:"#72767d",fontSize:12,marginTop:2}},"Show Account Switcher in Revenge settings menu")]),e.React.createElement(e.ReactNative.Switch,{key:"toggle",value:r.storage.settings.addToSidebar,onValueChange:function(p){w("addToSidebar",p),p?h.showToast("Sidebar enabled - restart app to see changes",0):h.showToast("Sidebar disabled - restart app to remove",0)},trackColor:{false:"#72767d",true:"#7289da"},thumbColor:"white"})]),e.React.createElement(e.ReactNative.View,{key:"confirm-delete",style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingVertical:12,backgroundColor:"#36393f",paddingHorizontal:16,borderRadius:8}},[e.React.createElement(e.ReactNative.Text,{key:"label",style:{color:"white",fontSize:16}},"Confirm Before Delete"),e.React.createElement(e.ReactNative.Switch,{key:"toggle",value:r.storage.settings.confirmBeforeDelete,onValueChange:function(p){return w("confirmBeforeDelete",p)},trackColor:{false:"#72767d",true:"#7289da"},thumbColor:"white"})])])])])}function _(t){X.useProxy(r.storage);const[n,d]=e.React.useState(!1),[l,u]=e.React.useState(null),[f,g]=e.React.useState(!1),[c,a]=e.React.useState(""),[s,o]=e.React.useState(""),[y,b]=e.React.useState(!1),[w,m]=e.React.useState(""),[T,v]=e.React.useState(null),[C,p]=e.React.useState(!1),N=re.getCurrentUser()?.id,P=function(R){const k=r.storage.accounts[R];if(!k)return;const A=R===N,I=k.username;i("info","Attempting to remove account",{username:I,isCurrent:A});const U=function(){delete r.storage.accounts[R],r.storage.accountOrder=r.storage.accountOrder.filter(function(W){return W!==R})},le=function(){U(),i("info","Account removed from switcher only",{username:I}),h.showToast(`Account ${I} removed from switcher`,0)},de=async function(){try{i("info","Starting account removal and logout",{username:I});const W=ne.getToken();await S.findByProps("login","logout","switchAccountToken").switchAccountToken(k.token),i("debug","Switched to account for logout"),await S.findByProps("login","logout").logout(),i("debug","Account logged out from Discord"),setTimeout(async function(){try{await S.findByProps("login","logout","switchAccountToken").switchAccountToken(W),i("debug","Switched back to original account")}catch(et){i("warn","Could not switch back to original account",{error:et.message})}},100)}catch(W){i("error","Failed to logout account from Discord",{error:W.message}),h.showToast("Failed to logout, but removed from switcher",1)}U(),i("info","Account removed and logged out",{username:I}),h.showToast(`Account ${I} removed and logged out`,0)};r.storage.settings.confirmBeforeDelete?e.ReactNative.Alert.alert(A?"Remove Current Account":"Remove Account",A?"Do you want to remove the current account from the switcher? (To logout, use Force Logout in settings)":`What do you want to do with ${I}?`,[{text:"Cancel",style:"cancel"},{text:"Delete from switcher only",onPress:le},!A&&{text:"Delete and logout",onPress:de}].filter(Boolean)):A?le():de()},Je=async function(R){const k=r.storage.accounts[R];if(k){u(R),i("info","Starting account switch",{username:k.username});try{h.showToast(`Switching to ${k.username}...`,0),await S.findByProps("login","logout","switchAccountToken").switchAccountToken(k.token),i("info","Account switch successful",{username:k.username}),h.showToast(`Switched to ${k.username}!`,0)}catch(A){i("error","Account switch failed",{username:k.username,error:A.message}),console.error("Switch error:",A),h.showToast(`Failed to switch: ${A.message}`,1)}u(null)}},Ke=function(R){if(!r.storage.settings.enableUnsafeFeatures)return;const k=r.storage.accounts[R];k&&(e.clipboard.setString(k.token),i("info","Token copied to clipboard",{username:k.username}),h.showToast(`Token for ${k.username} copied`,0))},Xe=async function(){b(!0),i("info","Adding current account");try{const R=ne.getToken(),k=re.getCurrentUser();if(!k||r.storage.accounts[k.id]){const I=r.storage.accounts[k.id]?"Current account already saved":"Failed to get current user";i("warn",I,{userId:k?.id}),h.showToast(I,1),b(!1);return}const A={id:k.id,username:k.username,discriminator:k.discriminator,avatar:k.avatar,displayName:k.globalName||k.username,token:R,addedAt:Date.now()};r.storage.accounts[k.id]=A,r.storage.accountOrder.includes(k.id)||r.storage.accountOrder.push(k.id),g(!1),i("info","Current account added successfully",{username:k.username}),h.showToast(`Current account ${k.username} added!`,0)}catch(R){i("error","Failed to add current account",{error:R.message}),console.error("Add current account error:",R),h.showToast("Failed to add current account",1)}b(!1)},Ye=async function(){await ae(r.storage,c,s,a,o,g,b,null,null,v,p)},qe=async function(){await ae(r.storage,c,s,a,o,g,b,w,T,v,p),m("")},Qe=function(R){return new Date(R).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},K=r.storage.accountOrder.filter(function(R){return r.storage.accounts[R]}).map(function(R){return r.storage.accounts[R]});return n?e.React.createElement(Ie,{onBack:function(){return d(!1)}}):C?e.React.createElement(e.ReactNative.View,{style:{flex:1,backgroundColor:"#1a1b1e",justifyContent:"center",padding:24}},[e.React.createElement(e.ReactNative.View,{key:"mfa-card",style:{backgroundColor:"#2b2d31",borderRadius:16,padding:24}},[e.React.createElement(e.ReactNative.Text,{key:"mfa-title",style:{color:"white",fontSize:22,fontWeight:"700",textAlign:"center",marginBottom:8}},"2FA Verification"),e.React.createElement(e.ReactNative.Text,{key:"mfa-desc",style:{color:"#8e9297",fontSize:14,textAlign:"center",marginBottom:24}},"Enter 6-digit code from authenticator or 8-digit backup code"),e.React.createElement(e.ReactNative.TextInput,{key:"mfa-input",placeholder:"000000",placeholderTextColor:"#72767d",value:w,onChangeText:m,keyboardType:"default",maxLength:8,style:{backgroundColor:"#1a1b1e",color:"white",padding:16,borderRadius:12,fontSize:24,textAlign:"center",letterSpacing:8,marginBottom:20,borderWidth:1,borderColor:"#3f4147"}}),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"mfa-submit",onPress:qe,disabled:w.length!==6&&w.length!==8||y,style:{backgroundColor:w.length===6||w.length===8?"#5865f2":"#3f4147",paddingVertical:14,borderRadius:12,alignItems:"center",marginBottom:12}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:16,fontWeight:"600"}},y?"Verifying...":"Verify")),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"mfa-cancel",onPress:function(){p(!1),v(null),m("")},style:{paddingVertical:12,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"#da373c",fontSize:14,fontWeight:"600"}},"Cancel"))])]):f?e.React.createElement(e.ReactNative.View,{style:{flex:1,backgroundColor:"#1a1b1e"}},[e.React.createElement(e.ReactNative.View,{key:"add-header",style:{flexDirection:"row",alignItems:"center",padding:16,backgroundColor:"#202225",borderBottomWidth:1,borderBottomColor:"#40444b"}},[e.React.createElement(e.ReactNative.TouchableOpacity,{key:"back",onPress:function(){g(!1),a(""),o("")},style:{marginRight:16}},e.React.createElement(e.ReactNative.Text,{style:{color:"#7289da",fontSize:16}},"\u2190 Back")),e.React.createElement(e.ReactNative.Text,{key:"title",style:{color:"white",fontSize:18,fontWeight:"bold"}},"Add Account")]),e.React.createElement(e.ReactNative.ScrollView,{key:"add-content",style:{flex:1},contentContainerStyle:{padding:16,paddingBottom:100}},[e.React.createElement(e.ReactNative.Text,{key:"instruction",style:{color:"#b9bbbe",fontSize:16,marginBottom:20,textAlign:"center"}},"Enter your Discord account credentials or add your current account"),e.React.createElement(e.ReactNative.TextInput,{key:"email-input",placeholder:"Email address",placeholderTextColor:"#72767d",value:c,onChangeText:a,keyboardType:"email-address",autoCapitalize:"none",style:{backgroundColor:"#40444b",color:"white",padding:16,borderRadius:8,marginBottom:12,fontSize:16}}),e.React.createElement(e.ReactNative.TextInput,{key:"password-input",placeholder:"Password",placeholderTextColor:"#72767d",value:s,onChangeText:o,secureTextEntry:!0,style:{backgroundColor:"#40444b",color:"white",padding:16,borderRadius:8,marginBottom:20,fontSize:16}}),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"login-btn",onPress:Ye,disabled:y,style:{backgroundColor:y?"#5c6bc0":"#7289da",paddingVertical:16,paddingHorizontal:20,borderRadius:8,alignItems:"center",marginBottom:12,opacity:y?.6:1}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:18,fontWeight:"bold"}},y?"Adding Account...":"Add Account with Email & Password")),e.React.createElement(e.ReactNative.View,{key:"divider",style:{height:1,backgroundColor:"#40444b",marginVertical:16}}),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"add-current-btn",onPress:Xe,disabled:y,style:{backgroundColor:y?"#5c6bc0":"#43b581",paddingVertical:16,paddingHorizontal:20,borderRadius:8,alignItems:"center",opacity:y?.6:1}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:18,fontWeight:"bold"}},y?"Adding...":"Add Current Account"))])]):e.React.createElement(e.ReactNative.View,{style:{flex:1,backgroundColor:"#1a1b1e"}},[e.React.createElement(e.ReactNative.View,{key:"header",style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",padding:20,backgroundColor:"#111214",borderBottomWidth:0}},[e.React.createElement(e.ReactNative.Text,{key:"title",style:{color:"white",fontSize:22,fontWeight:"700"}},"Account Switcher"),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"settings-btn",onPress:function(){return d(!0)},style:{paddingVertical:10,paddingHorizontal:16,borderRadius:10,backgroundColor:"#2b2d31"}},e.React.createElement(e.ReactNative.Text,{style:{color:"#b5bac1",fontSize:14,fontWeight:"600"}},"Settings"))]),e.React.createElement(e.ReactNative.View,{key:"accounts-section",style:{flex:1,padding:16}},[e.React.createElement(e.ReactNative.Text,{key:"section-title",style:{color:"#8e9297",fontSize:12,fontWeight:"700",marginBottom:16,letterSpacing:.5}},`SAVED ACCOUNTS (${K.length})`),K.length===0?e.React.createElement(e.ReactNative.View,{key:"empty",style:{alignItems:"center",justifyContent:"center",paddingVertical:40}},[e.React.createElement(e.ReactNative.Text,{key:"empty-text",style:{color:"#72767d",fontSize:16,marginBottom:8}},"No accounts saved yet"),e.React.createElement(e.ReactNative.Text,{key:"empty-hint",style:{color:"#72767d",fontSize:14,textAlign:"center"}},"Access the switcher by pressing the logout button on the main settings page.")]):e.React.createElement(e.ReactNative.ScrollView,{key:"accounts-scroll",style:{flex:1},contentContainerStyle:{paddingBottom:100}},K.map(function(R,k){const A=R.id===N,I=l===R.id;let U="https://cdn.discordapp.com/embed/avatars/1.png";return R.avatar&&(U=`https://cdn.discordapp.com/avatars/${R.id}/${R.avatar}.png?size=48`),e.React.createElement(e.ReactNative.View,{key:R.id,style:{flexDirection:"row",alignItems:"center",backgroundColor:A?"#5865f215":"#2b2d31",borderWidth:A?1:0,borderColor:"#5865f2",borderRadius:16,padding:14,marginBottom:12}},[e.React.createElement(e.ReactNative.TouchableOpacity,{key:"avatar",onPress:function(){return Je(R.id)},disabled:A||I,style:{marginRight:12}},e.React.createElement(e.ReactNative.Image,{source:{uri:U},style:{width:48,height:48,borderRadius:24,opacity:A||I?.7:1}})),e.React.createElement(e.ReactNative.View,{key:"info",style:{flex:1}},[e.React.createElement(e.ReactNative.Text,{key:"name",style:{color:"white",fontSize:16,fontWeight:"bold"}},`${k+1}. ${r.storage.settings.enableCLI?`${R.username}${R.discriminator!=="0"?`#${R.discriminator}`:""}`:R.displayName}`),e.React.createElement(e.ReactNative.Text,{key:"status",style:{color:A?"#43b581":"#72767d",fontSize:12,marginTop:2}},A?"Current Account":I?"Switching...":"Tap avatar to switch"),e.React.createElement(e.ReactNative.Text,{key:"date",style:{color:"#72767d",fontSize:11,marginTop:2}},`Added: ${Qe(R.addedAt||Date.now())}`)]),e.React.createElement(e.ReactNative.View,{key:"actions",style:{flexDirection:"column",alignItems:"flex-end"}},[r.storage.settings.enableUnsafeFeatures&&e.React.createElement(e.ReactNative.TouchableOpacity,{key:"copy",onPress:function(){return Ke(R.id)},style:{backgroundColor:"#3f4147",paddingHorizontal:14,paddingVertical:8,borderRadius:8,minWidth:80,alignItems:"center",marginBottom:6}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:12,fontWeight:"bold"}},"Copy Token")),e.React.createElement(e.ReactNative.TouchableOpacity,{key:"remove",onPress:function(){return P(R.id)},style:{backgroundColor:"#da373c",paddingHorizontal:14,paddingVertical:8,borderRadius:8,minWidth:80,alignItems:"center"}},e.React.createElement(e.ReactNative.Text,{style:{color:"white",fontSize:12,fontWeight:"bold"}},"Remove"))])])}))]),e.React.createElement(e.ReactNative.View,{key:"bottom-actions",style:{position:"absolute",bottom:0,left:0,right:0,backgroundColor:"#111214",borderTopWidth:0,paddingVertical:16,paddingHorizontal:20,paddingBottom:40}},e.React.createElement(e.ReactNative.TouchableOpacity,{key:"add",onPress:function(){return g(!0)},style:{backgroundColor:"#5865f2",paddingVertical:16,paddingHorizontal:24,borderRadius:14,alignItems:"center",flexDirection:"row",justifyContent:"center"}},[e.React.createElement(e.ReactNative.Text,{key:"add-icon",style:{color:"white",fontSize:20,marginRight:8}},"+"),e.React.createElement(e.ReactNative.Text,{key:"add-text",style:{color:"white",fontSize:18,fontWeight:"bold"}},"Add Account")]))])}const{FormSection:Pe,FormRow:G}=he.Forms,{TableRowIcon:Be}=S.findByProps("TableRowIcon"),D=window.bunny,oe=D?.metro?.findByPropsLazy("getRootNavigationRef"),Z=D?.metro?.findByPropsLazy("SETTING_RENDERER_CONFIG"),ce=D?.metro?.findByNameLazy("SettingsOverviewScreen",!1),ie=D.metro.findByPropsLazy("createList");function Ve({tabs:t}){const n=e.NavigationNative.useNavigation();return e.React.createElement(G,{label:t.title(),leading:e.React.createElement(G.Icon,{source:t.icon}),trailing:e.React.createElement(e.React.Fragment,{},[t.trailing?t.trailing():null,e.React.createElement(G.Arrow,{key:"arrow"})]),onPress:function(){const d=t.page;n.navigate("VendettaCustomPage",{title:t.title(),render:function(){return e.React.createElement(d)}})}})}function Oe(t,n){try{n.push(O.after("default",D?.metro?.findByNameLazy("UserSettingsOverviewWrapper",!1),function(d,l){const u=V.findInReactTree(l.props.children,function(f){return f.type?.name==="UserSettingsOverview"});u&&n.push(O.after("render",u.type.prototype,function(f,g){const c=V.findInReactTree(g.props.children,function(a){return a?.children?.[1]?.type===Pe})?.children;if(c){const a=c.findIndex(function(s){return["BILLING_SETTINGS","PREMIUM_SETTINGS"].includes(s?.props?.label)});c.splice(-~a||4,0,e.React.createElement(Ve,{key:t.key,tabs:t}))}}))},!0))}catch(d){ye.logger.info("Panel UI patch failed graciously \u{1F494}",d)}}function Fe(t,n){if(!Z||!ce||!oe){console.warn("[AccountSwitcher] Missing required constants for tabs UI patch");return}const d={};d[t.key]={type:"pressable",title:t.title,icon:t.icon,IconComponent:t.icon&&function(){const f=typeof t.icon=="object"&&t.icon.uri!==void 0?t.icon.uri:t.icon;return e.React.createElement(Be,{source:f})},usePredicate:t.predicate,useTrailing:t.trailing,onPress:function(){const f=oe.getRootNavigationRef(),g=t.page;f.navigate("VendettaCustomPage",{title:t.title(),render:function(){return e.React.createElement(g)}})},withArrow:!0};let l=Z.SETTING_RENDERER_CONFIG;Object.defineProperty(Z,"SETTING_RENDERER_CONFIG",{enumerable:!0,configurable:!0,get:function(){return{...l,...d}},set:function(f){return l=f}});const u=Symbol("AccountSwitcher-pinToSettings");try{if(!ie)return;n.push(O.after("createList",ie,function(f,g){if(!f[0][u]){f[0][u]=!0;const[c]=f,a=c.sections,s=a?.find(function(o){["Bunny","Kettu","Revenge"].some(function(y){return o.label===y&&o.title===y})});s||Boolean(a?.find(function(o){return o.settings[0]=="PREMIUM"}))&&a.unshift({label:r.manifest.name,title:r.manifest.name,settings:[t.key]}),s?.settings&&(s.settings=[...s.settings,t.key])}}))}catch{n.push(O.after("default",ce,function(f,g){if(!f[0][u]){f[0][u]=!0;const{sections:c}=V.findInReactTree(g,function(s){return s.props?.sections}).props,a=c?.find(function(s){return["Bunny","Kettu","Revenge"].some(function(o){return s.label===o&&s.title===o})});a||Boolean(c?.find(function(s){return s.settings[0]=="PREMIUM"}))&&c.unshift({label:r.manifest.name,title:r.manifest.name,settings:[t.key]}),a?.settings&&(a.settings=[...a.settings,t.key])}}))}}function ze(t){const n=[];let d=!1;const l=t.predicate||function(){return!0};return t.predicate=function(){return d?!1:l()},Oe(t,n),Fe(t,n),n.push(function(){return d=!0}),function(){for(const u of n)u()}}function Le(){if(!r.storage.settings?.addToSidebar)return console.log("[AccountSwitcher] Sidebar disabled in settings"),function(){};console.log("[AccountSwitcher] Patching sidebar using custom patchSettingsPin...");try{const t=ze({key:"AccountSwitcher",icon:j.getAssetIDByName("UserIcon"),title:function(){return"Account Switcher"},predicate:function(){return r.storage.settings?.addToSidebar===!0},page:_});return console.log("[AccountSwitcher] Successfully patched sidebar"),t}catch(t){return console.error("[AccountSwitcher] Failed to patch sidebar:",t),function(){}}}const $e=window.bunny,De=$e?.metro?.findByPropsLazy("getRootNavigationRef");function Ue(){return Object.keys(r.storage.accounts||{}).length}function We(t){t?.(),setTimeout(function(){try{const n=De?.getRootNavigationRef();n&&n.navigate("VendettaCustomPage",{title:"Account Switcher",render:function(){return e.React.createElement(_)}})}catch(n){console.error("[StatusPicker] Nav error:",n),h.showToast("Failed to open Account Switcher",1)}},100)}function Me(){const t=[];try{const n=O.before("render",S.findByProps("ScrollView").View,function(d){try{let l=V.findInReactTree(d,function(a){return a?.key===".$SetCustomStatus"||a?.key===".$StatusPicker"||a?.props?.sheetKey==="SetCustomStatus"||a?.props?.sheetKey==="StatusPicker"});if(l||(l=V.findInReactTree(d,function(a){return a?.props?.content?.props?.options?a.props.content.props.options.some(function(s){return s?.label==="Set Custom Status"||s?.label==="Set a custom status"||s?.label==="Clear Status"||s?.label==="\xD6zel Durum Belirle"||s?.label==="Durumu Temizle"||s?.label?.toLowerCase?.()?.includes?.("status")||s?.label?.toLowerCase?.()?.includes?.("durum")}):!1})),!l?.props?.content?.props?.options)return;const u=l.props.content.props,f=Ue()>0?"Hesap De\u011Fi\u015Ftir":"Hesap Ekle";if(u.options.some(function(a){return a?.label==="Switch Account"||a?.label==="Add Account"||a?.label==="Hesap De\u011Fi\u015Ftir"||a?.label==="Hesap Ekle"}))return;const g={label:f,icon:j.getAssetIDByName("ic_person_add_24px")||j.getAssetIDByName("ic_add_friend"),onPress:function(){return We(u.hideActionSheet)}},c=u.options.findIndex(function(a){return a?.label==="Set Custom Status"||a?.label==="Set a custom status"||a?.label==="\xD6zel Durum Belirle"||a?.label?.toLowerCase?.()?.includes?.("durum")});c!==-1?u.options.splice(c+1,0,g):u.options.push(g)}catch{}});t.push(n),console.log("[StatusPicker] Patched")}catch(n){console.error("[StatusPicker] Failed:",n)}return function(){return t.forEach(function(n){return n?.()})}}const{meta:{resolveSemanticColor:_e}}=S.findByProps("colors","meta"),He=S.findByStoreName("ThemeStore"),B=S.findByStoreName("UserStore"),E=function(){return parseInt(_e(He.theme,ue.semanticColors.BACKGROUND_SECONDARY).slice(1),16)},z={author:{username:"AccountSwitcher",avatar:"command",avatarURL:be?.command}};r.storage.accounts||(r.storage.accounts={}),r.storage.accountOrder||(r.storage.accountOrder=[]),r.storage.settings?(r.storage.settings.enableUnsafeFeatures===void 0&&(r.storage.settings.enableUnsafeFeatures=!1),r.storage.settings.enableCLI===void 0&&(r.storage.settings.enableCLI=r.storage.settings.showAccountNames!==!1),r.storage.settings.confirmBeforeDelete===void 0&&(r.storage.settings.confirmBeforeDelete=!0),r.storage.settings.addToSidebar===void 0&&(r.storage.settings.addToSidebar=!0),r.storage.settings.showAccountNames!==void 0&&delete r.storage.settings.showAccountNames):r.storage.settings={enableCLI:!0,confirmBeforeDelete:!0,enableUnsafeFeatures:!1,addToSidebar:!0};let J;function x(){return window.sendMessage?window.sendMessage?.(...arguments):(J||(J=pe?.(vendetta)),J?.(...arguments))}function F(t){return!t||!t.username?"Unknown Account":t.username}function se(t){const n=r.storage.accounts||{},d=r.storage.accountOrder||[],l=parseInt(t);if(!isNaN(l)&&l>=1&&l<=d.length){const u=d[l-1];return n[u]?[u,n[u]]:null}return Object.entries(n).find(function([u,f]){return f.username.toLowerCase()===t.toLowerCase()||F(f).toLowerCase()===t.toLowerCase()})}function H(t){const n=(r.storage.accountOrder||[]).indexOf(t);return n>=0?n+1:null}function je(t){r.storage.accountOrder||(r.storage.accountOrder=[]),r.storage.accountOrder.includes(t)||r.storage.accountOrder.push(t)}function Ge(t){r.storage.accountOrder||(r.storage.accountOrder=[]);const n=r.storage.accountOrder.indexOf(t);n>-1&&r.storage.accountOrder.splice(n,1)}var Ze={meta:vendetta.plugin,settings:_,patches:[],onUnload(){this.patches.forEach(function(t){return t()}),this.patches=[]},onLoad(){const t=Le();this.patches.push(t);const n=Me();this.patches.push(n);const d=O.before("render",S.findByProps("ScrollView").View,function(g){try{let c=V.findInReactTree(g,function(o){return o?.props?.content?.props?.options?(o?.key&&console.log("[MoreAlts] Found sheet key:",o.key,"sheetKey:",o?.props?.sheetKey),o?.props?.content?.props?.options?.length>0):!1});if(!c?.props?.content?.props?.options)return;const a=c.props.content.props;if(!a.options.some(function(o){return o?.label?.toLowerCase?.()?.includes?.("online")||o?.label?.toLowerCase?.()?.includes?.("idle")||o?.label?.toLowerCase?.()?.includes?.("invisible")||o?.label?.toLowerCase?.()?.includes?.("\xE7evrimi\xE7i")||o?.label?.toLowerCase?.()?.includes?.("bo\u015Fta")||o?.label?.toLowerCase?.()?.includes?.("g\xF6r\xFCnmez")}))return;const s=Object.keys(r.storage.accounts||{}).length>0?"Hesap De\u011Fi\u015Ftir":"Hesap Ekle";if(a.options.some(function(o){return o?.label===s}))return;a.options.push({label:s,icon:getAssetIDByName("ic_person_add_24px")||getAssetIDByName("ic_add_friend")||getAssetIDByName("ic_group"),onPress:function(){a.hideActionSheet?.(),setTimeout(function(){try{const o=bunny?.metro?.findByPropsLazy("getRootNavigationRef")?.getRootNavigationRef();o&&o.navigate("VendettaCustomPage",{title:"Account Switcher",render:function(){return e.React.createElement(_)}})}catch{h.showToast("Settings'ten Account Switcher'a git",0)}},100)}})}catch{}});this.patches.push(d);const l="Copy Token",u=O.before("render",S.findByProps("ScrollView").View,function(g){try{if(!r.storage.settings?.enableUnsafeFeatures)return;let c=V.findInReactTree(g,function(b){return b.key===".$UserProfileOverflow"});if(!c||!c.props||c.props.sheetKey!=="UserProfileOverflow")return;const a=c.props.content.props;if(a.options.some(function(b){return b?.label===l}))return;const s=B.getCurrentUser()?.id,o=Object.keys(c._owner.stateNode._keyChildMapping).find(function(b){return c._owner.stateNode._keyChildMapping[b]&&b.match(/(?<=\$UserProfile)\d+/)})?.slice?.(13)||s,y=S.findByProps("getToken").getToken();a.options.unshift({isDestructive:!0,label:l,onPress:function(){try{h.showToast(o===s?"Copied your token":`Copied token of ${a.header.title}`),fe.setString(o===s?y:[Buffer.from(o).toString("base64").replaceAll("=",""),Re?.(+Date.now()-129384e4,!0)||"dummy",we?.(q,27)||"dummy"].join(".")),a.hideActionSheet()}catch(b){console.error(b),h.showToast("Failed to copy token",1)}}})}catch(c){console.error("Context menu patch error:",c)}});this.patches.push(u);const f={async mainCommand(g,c){try{const a={...z,interaction:{name:"/accswitcher",user:B.getCurrentUser()}};x?.({loggingName:"AccSwitcher main message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Account Switcher",description:r.storage.settings.addToSidebar?"Account Manager is available in your settings sidebar!\n\nQuick commands:\n\u2022 `/accswitcher login <#>` - Switch to account\n\u2022 `/accswitcher add` - Add current account\n\u2022 `/accswitcher list` - Show all accounts":"Opening Account Manager...\n\nQuick commands:\n\u2022 `/accswitcher login <#>` - Switch to account\n\u2022 `/accswitcher add` - Add current account\n\u2022 `/accswitcher list` - Show all accounts",footer:{text:r.storage.settings.addToSidebar?"Check your settings sidebar for Account Switcher":"Check plugin settings for the Account Manager interface"}}]},a),h.showToast(r.storage.settings.addToSidebar?"Check settings sidebar for Account Switcher":"Check plugin settings to access Account Manager",0)}catch(a){console.error("Main command error:",a),h.showToast("Check plugin settings to access Account Manager",1)}},async addAccount(g,c){try{const a={...z,interaction:{name:"/accswitcher add",user:B.getCurrentUser()}},s=S.findByProps("getToken").getToken(),o=B.getCurrentUser();if(!o){x?.({loggingName:"Add account error message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Failed to Get Current User",description:"Could not retrieve current user information."}]},a);return}if(r.storage.accounts[o.id]){const w=H(o.id);x?.({loggingName:"Add account warning message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Account Already Saved",description:`Your current account **${w}. ${o.username}** is already saved.`}]},a);return}const y={id:o.id,username:o.username,discriminator:o.discriminator,avatar:o.avatar,displayName:o.globalName||o.username,token:s,addedAt:Date.now()};r.storage.accounts[o.id]=y,je(o.id);const b=H(o.id);x?.({loggingName:"Add account success message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Account Added Successfully",description:`**${b}. ${o.username}** has been saved.`,footer:{text:`Total accounts: ${Object.keys(r.storage.accounts).length}`}}]},a)}catch(a){console.error("Add account error:",a),h.showToast("Failed to add account",1)}},async login(g,c){try{const a={...z,interaction:{name:"/accswitcher login",user:B.getCurrentUser()}},s=new Map(g.map(function(m){return[m.name,m]})).get("account")?.value;if(!s){x?.({loggingName:"Login error message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"No Account Specified",description:"Please specify an account number, username, or ID."}]},a);return}const o=se(s);if(!o){const m=(r.storage.accountOrder||[]).filter(function(T){return r.storage.accounts[T]}).map(function(T,v){return`${v+1}. ${F(r.storage.accounts[T])}`}).join(`
`);x?.({loggingName:"Login error message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Account Not Found",description:`Could not find account "${s}".${m?`

**Available accounts:**
${m}`:"\n\nNo accounts saved yet. Use `/accswitcher add` first."}`}]},a);return}const[y,b]=o,w=H(y);x?.({loggingName:"Login process message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:`Switching to ${w}. ${F(b)}...`}]},a);try{await S.findByProps("login","logout","switchAccountToken").switchAccountToken(b.token),h.showToast(`Switched to ${w}. ${F(b)}!`,0)}catch(m){console.error("Switch error:",m),x?.({loggingName:"Login failure message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Failed to switch accounts",description:`Error: ${m.message}`}]},a)}}catch(a){console.error("Login command error:",a),h.showToast("Failed to execute login command",1)}},listAccounts(g,c){try{const a={...z,interaction:{name:"/accswitcher list",user:B.getCurrentUser()}},s=r.storage.accounts||{},o=Object.keys(s).length;if(o===0){x?.({loggingName:"List accounts empty message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"No Saved Accounts",description:"Use `/accswitcher add` to save your current account."}]},a);return}const y=(r.storage.accountOrder||[]).filter(function(b){return s[b]}).map(function(b,w){const m=s[b],T=F(m),v=new Date(m.addedAt).toLocaleDateString();return`**${w+1}.** ${T} - Added: ${v}`}).join(`
`);x?.({loggingName:"List accounts message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:`Saved Accounts (${o})`,description:y,footer:{text:"Use /accswitcher login <number or username> to switch accounts"}}]},a)}catch(a){console.error("List accounts error:",a),h.showToast("Failed to list accounts",1)}},removeAccount(g,c){try{const a={...z,interaction:{name:"/accswitcher remove",user:B.getCurrentUser()}},s=new Map(g.map(function(m){return[m.name,m]})).get("account")?.value;if(!s){x?.({loggingName:"Remove account error message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"No Account Specified",description:"Please specify an account number, username, or ID to remove."}]},a);return}const o=se(s);if(!o){const m=(r.storage.accountOrder||[]).filter(function(T){return r.storage.accounts[T]}).map(function(T,v){return`${v+1}. ${F(r.storage.accounts[T])}`}).join(`
`);x?.({loggingName:"Remove account error message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Account Not Found",description:`Could not find account "${s}".${m?`

**Available accounts:**
${m}`:`

No accounts saved yet.`}`}]},a);return}const[y,b]=o,w=`${H(y)}. ${F(b)}`;delete r.storage.accounts[y],Ge(y),x?.({loggingName:"Remove account success message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Account Removed",description:`**${w}** has been removed from saved accounts.`,footer:{text:`Remaining accounts: ${Object.keys(r.storage.accounts).length}`}}]},a)}catch(a){console.error("Remove account error:",a),h.showToast("Failed to remove account",1)}},getCurrentToken(g,c){try{const a={...z,interaction:{name:"/accswitcher token",user:B.getCurrentUser()}};if(!r.storage.settings?.enableUnsafeFeatures){x?.({loggingName:"Get token disabled message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Unsafe Features Disabled",description:"Token access is disabled. Enable 'Unsafe Features' in plugin settings to use this command."}]},a);return}const{getToken:s}=S.findByProps("getToken"),o=s();x?.({loggingName:"Get token message",channelId:c.channel.id,embeds:[{color:E(),type:"rich",title:"Current Account Token",description:`\`${o}\``,footer:{text:"Keep your token secure and never share it!"}}]},a)}catch(a){console.error("Get token error:",a),h.showToast("Failed to get current token",1)}}};try{[{type:1,inputType:1,applicationId:"-1",execute:f.mainCommand,name:"accswitcher",description:"Open Account Switcher (check plugin settings)",options:[]},{type:1,inputType:1,applicationId:"-1",execute:f.addAccount,name:"accswitcher add",description:"Add your current account to saved accounts",options:[]},{type:1,inputType:1,applicationId:"-1",execute:f.login,name:"accswitcher login",description:"Switch to a saved account",options:[{required:!0,type:3,name:"account",description:"Account number, username, or ID to switch to"}]},{type:1,inputType:1,applicationId:"-1",execute:f.listAccounts,name:"accswitcher list",description:"Show all saved accounts",options:[]},{type:1,inputType:1,applicationId:"-1",execute:f.removeAccount,name:"accswitcher remove",description:"Remove a saved account",options:[{required:!0,type:3,name:"account",description:"Account number, username, or ID to remove"}]},{type:1,inputType:1,applicationId:"-1",execute:f.getCurrentToken,name:"accswitcher token",description:"Get your current account token (requires unsafe features)",options:[]}].forEach(function(g){try{ge.registerCommand(g)}catch(c){console.error(`Failed to register command ${g.name}:`,c)}}),console.log("Account Switcher plugin loaded successfully")}catch(g){console.error("Failed to register commands:",g)}}};return M.EMBED_COLOR=E,M.default=Ze,Object.defineProperty(M,"__esModule",{value:!0}),M})({},vendetta.ui,vendetta.commands,vendetta.metro,vendetta.utils,vendetta.metro.common.clipboard,vendetta.patcher,vendetta.ui.toasts,vendetta.plugin,vendetta.metro.common,vendetta.storage,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta);
